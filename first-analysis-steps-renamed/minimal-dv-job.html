

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Running a minimal DaVinci job locally &mdash; FCC Starterkit Lessons  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/panels.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/panels.css" type="text/css" />
  <link rel="stylesheet" href="../_static/starterkit.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> FCC Starterkit Lessons
          

          
            
            <img src="../_static/starterkit.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../software-basics/README.html">First  Steps</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../software-basics/prerequisites.html">Pre-workshop checklist</a></li>
<li class="toctree-l2"><a class="reference internal" href="../software-basics/introduction-to-course.html">Goals of the course</a></li>
<li class="toctree-l2"><a class="reference internal" href="../software-basics/fccsw.html">An introduction to FCC Software</a></li>
<li class="toctree-l2"><a class="reference internal" href="../software-basics/bookkeeping.html">Finding data in the Bookkeeping</a></li>
<li class="toctree-l2"><a class="reference internal" href="../software-basics/exploring-fcc-files.html">Inspecting an FCC data file</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../software-basics/exploring-fcc-files.html#the-events-tree">The <code class="docutils literal notranslate"><span class="pre">events</span></code> tree</a></li>
<li class="toctree-l3"><a class="reference internal" href="../software-basics/exploring-fcc-files.html#the-metadata-tree">The <code class="docutils literal notranslate"><span class="pre">metadata</span></code> tree</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../software-basics/asking-questions.html">Asking good questions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../fast-sim-and-analysis/README.html">Generators, Fast Simulation and Analysis</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../fast-sim-and-analysis/FccSoftwareGettingStartedFastSim.html">FCC: Getting started with the production and analysis of fast-simulated events</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../fast-sim-and-analysis/FccSoftwareGettingStartedFastSim.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fast-sim-and-analysis/FccSoftwareGettingStartedFastSim.html#installation">Installation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../fast-sim-and-analysis/FccSoftwareGettingStartedFastSim.html#set-up-your-working-directory">Set up your working directory</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../fast-sim-and-analysis/FccSoftwareGettingStartedFastSim.html#getting-started-with-delphes">Getting started with Delphes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../fast-sim-and-analysis/FccSoftwareGettingStartedFastSim.html#run-fccsw-with-pythia8-delphes">Run FCCSW with Pythia8+Delphes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../fast-sim-and-analysis/FccSoftwareGettingStartedFastSim.html#run-the-analysis-in-heppy">Run the analysis in heppy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../fast-sim-and-analysis/FccSoftwareGettingStartedFastSim.html#make-plots">Make plots</a></li>
<li class="toctree-l4"><a class="reference internal" href="../fast-sim-and-analysis/FccSoftwareGettingStartedFastSim.html#cutflow">CutFlow</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../fast-sim-and-analysis/FccSoftwareGettingStartedFastSim.html#legacy-using-the-papas-tool-for-fcc-ee">Legacy: using the Papas tool (for FCC-ee)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../fast-sim-and-analysis/FccSoftwareGettingStartedFastSim.html#id1">Set up your working directory</a></li>
<li class="toctree-l4"><a class="reference internal" href="../fast-sim-and-analysis/FccSoftwareGettingStartedFastSim.html#generate-events-with-pythia8">Generate events with pythia8</a></li>
<li class="toctree-l4"><a class="reference internal" href="../fast-sim-and-analysis/FccSoftwareGettingStartedFastSim.html#run-papas-and-the-analysis-in-heppy">Run papas and the analysis in heppy</a></li>
<li class="toctree-l4"><a class="reference internal" href="../fast-sim-and-analysis/FccSoftwareGettingStartedFastSim.html#id2">Make plots</a></li>
<li class="toctree-l4"><a class="reference internal" href="../fast-sim-and-analysis/FccSoftwareGettingStartedFastSim.html#more-information">More information</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../fast-sim-and-analysis/FccFullAnalysis.html">FCC-hh: Pythia, Delphes, Heppy Analysis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../fast-sim-and-analysis/FccFullAnalysis.html#part-i-generate-and-simulate-events-with-fccsw">Part I: Generate and simulate Events with FCCSW</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fast-sim-and-analysis/FccFullAnalysis.html#part-ii-analyze-the-output-with-heppy">Part II: Analyze the output with Heppy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fast-sim-and-analysis/FccFullAnalysis.html#part-iii-produce-plots">Part III: Produce plots</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fast-sim-and-analysis/FccFullAnalysis.html#part-iv-homework">Part IV: Homework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fast-sim-and-analysis/FccFullAnalysis.html#other-documentation">Other documentation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../fast-sim-and-analysis/FcceeAnalysis.html">FCC-ee: Getting started with analysing simulated physics events</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../fast-sim-and-analysis/FcceeAnalysis.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fast-sim-and-analysis/FcceeAnalysis.html#installation">Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fast-sim-and-analysis/FcceeAnalysis.html#instructions">Instructions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../fast-sim-and-analysis/FcceeAnalysis.html#exercices">Exercices</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../full-detector-simulations/README.html">Full Detector Simulations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../full-detector-simulations/FccCaloPerformance.html">FCC Calorimeter Performance Studies Workflow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../full-detector-simulations/FccCaloPerformance.html#using-the-dd4hep-detector-model-in-fcc-software">Using the DD4hep detector model in FCC Software.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../full-detector-simulations/FccCaloPerformance.html#running-geant4-within-the-fcc-software-framework">Running Geant4 within the FCC Software Framework</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../full-detector-simulations/FccCaloPerformance.html#obtaining-and-plotting-the-energy-resolution">Obtaining and Plotting the Energy Resolution</a></li>
<li class="toctree-l4"><a class="reference internal" href="../full-detector-simulations/FccCaloPerformance.html#extracting-and-plotting-the-resolution">Extracting and Plotting the Resolution</a></li>
<li class="toctree-l4"><a class="reference internal" href="../full-detector-simulations/FccCaloPerformance.html#further-topics-parametrizing-the-energy-resolution">Further Topics: Parametrizing the Energy Resolution</a></li>
<li class="toctree-l4"><a class="reference internal" href="../full-detector-simulations/FccCaloPerformance.html#further-topics-calculating-the-sampling-fraction-and-using-it-in-simulation">Further Topics: Calculating the Sampling Fraction and using it in Simulation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../full-detector-simulations/FCCeeDriftChamber.html">FCCee: Full Simulation of IDEA Driftchamber</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../full-detector-simulations/FCCeeDriftChamber.html#part-i-simulations-with-the-idea-detector-model-in-fccsw">Part I: Simulations with the IDEA detector model in  FCCSW</a></li>
<li class="toctree-l3"><a class="reference internal" href="../full-detector-simulations/FCCeeDriftChamber.html#part-ii-user-task-basic-reconstruction-with-a-hough-transform">Part II User Task: Basic Reconstruction with a Hough-Transform</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../developing-fcc-software/README.html">Developing FCCSW</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../developing-fcc-software/FccSoftwareGit.html">Github workflow and contribution guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../developing-fcc-software/FccSoftwareGit.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developing-fcc-software/FccSoftwareGit.html#first-time-setup-of-git">First time setup of git</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developing-fcc-software/FccSoftwareGit.html#generate-and-set-up-ssh-keys-for-github">Generate and set up ssh keys for github</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developing-fcc-software/FccSoftwareGit.html#improving-your-git-experience">Improving your git experience</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developing-fcc-software/FccSoftwareGit.html#development-workflow">Development workflow</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developing-fcc-software/FccSoftwareGit.html#keeping-your-local-repository-up-to-date">Keeping your local repository up to date</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developing-fcc-software/FccSoftwareGit.html#contributing-code">Contributing code</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../developing-fcc-software/FccSoftwareGit.html#recommendations">Recommendations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developing-fcc-software/FccSoftwareGit.html#general-recommendations">General recommendations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developing-fcc-software/FccSoftwareGit.html#commit-comments">Commit comments</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developing-fcc-software/FccSoftwareGit.html#cleaning-history">Cleaning history</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developing-fcc-software/FccSoftwareGit.html#pull-requests">Pull requests</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../developing-fcc-software/FccSoftwareGit.html#trouble-shooting">Trouble-shooting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developing-fcc-software/FccSoftwareGit.html#when-i-try-to-push-to-the-repository-i-get-an-authentication-error">When I try to push to the repository, I get an authentication error</a></li>
<li class="toctree-l4"><a class="reference internal" href="../developing-fcc-software/FccSoftwareGit.html#i-have-cloned-with-https-and-now-i-can-t-push-my-changes-what-do-i-do">I have cloned with https and now I can’t push my changes, what do I do?</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../developing-fcc-software/FccSoftwareGit.html#need-help">Need help?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../developing-fcc-software/FccCMakeGuide.html">CMake guide for the FCC software</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../developing-fcc-software/FccCMakeGuide.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developing-fcc-software/FccCMakeGuide.html#quick-start-into-building-fccsw">Quick start into building FCCSW</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developing-fcc-software/FccCMakeGuide.html#cmake-example-packages">CMake example packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developing-fcc-software/FccCMakeGuide.html#cmake-in-the-fcc-software-framework">CMake in the FCC software framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developing-fcc-software/FccCMakeGuide.html#ctest-in-fccsw">CTest in FCCSW</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developing-fcc-software/FccCMakeGuide.html#using-an-internal-library">Using an internal library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developing-fcc-software/FccCMakeGuide.html#building-a-new-gaudi-module">Building a new Gaudi module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developing-fcc-software/FccCMakeGuide.html#using-an-external-library">Using an external library</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developing-fcc-software/FccCMakeGuide.html#customizing-how-cmake-is-run">Customizing how CMake is run</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../developing-fcc-software/FccDocPage.html">Writing documentation for the FCC software</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../developing-fcc-software/FccDocPage.html#where-to-put-documentation">Where to put documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developing-fcc-software/FccDocPage.html#when-and-how-is-the-documentation-page-updated">When and how is the documentation page updated?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developing-fcc-software/FccDocPage.html#structure-of-the-content">Structure of the content</a></li>
<li class="toctree-l3"><a class="reference internal" href="../developing-fcc-software/FccDocPage.html#running-website-generation-locally">Running website generation locally</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../developing-fcc-software/FccDocPage.html#about-jekyll">About jekyll</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../developing-fcc-software/FccDocPage.html#for-website-admins">For website admins</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING.html">Contributing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../CONTRIBUTING.html#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../CONTRIBUTING.html#dependencies">Dependencies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../CONDUCT.html">Contributor Code of Conduct</a></li>
<li class="toctree-l3"><a class="reference internal" href="../LICENSE.html">Instructional Material</a></li>
<li class="toctree-l3"><a class="reference internal" href="../LICENSE.html#software">Software</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">External links:</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://hsf-training.github.io/analysis-essentials/">Analysis essentials</a></li>
<li class="toctree-l1"><a class="reference external" href="https://lhcb.github.io/starterkit">LHCb starterkit</a></li>
<li class="toctree-l1"><a class="reference external" href="https://hep-fcc.github.io/glossary">FCC software glossary</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">FCC Starterkit Lessons</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Running a minimal DaVinci job locally</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/HEP-FCC/fcc-tutorials/blob/master/first-analysis-steps-renamed/minimal-dv-job.md" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="running-a-minimal-davinci-job-locally">
<h1>Running a minimal DaVinci job locally<a class="headerlink" href="#running-a-minimal-davinci-job-locally" title="Permalink to this headline">¶</a></h1>
<p><a class="reference internal" href="interactive-dst.html"><span class="doc">Looping event-by-event</span></a> over a file and <a class="reference internal" href="loki-functors.html"><span class="doc">inspecting
interesting quantities with LoKi functors</span></a> is great for
exploration: to check that the file contains the candidates you need, that
the topology makes sense, and so on.
It’s impractical for most cases, though, where you want <em>all</em> the candidates
your trigger/stripping line produced, which could be tens of millions of
decays.
In these cases we use DaVinci, the application for analysing high-level
information such as tracks and vertices, which we’ll look at in this lesson to
produce a ROOT ntuple.</p>
<div class="panel panel-objectives docutils container">
<div class="panel-header open docutils container">
<p id="learning-objectives"><i class="fa fa-line-chart"></i> Learning Objectives</p>
</div>
<div class="panel-body docutils container">
<ul class="simple">
<li><p>Run a DaVinci job over a local DST</p></li>
<li><p>Inspect the ntuple output</p></li>
<li><p>Set up the job to run in Ganga</p></li>
</ul>
</div>
</div>
<p>With some stripped data located, it’s useful to store the information on the
selected particles inside an ntuple.
This allows for quick, local analysis with <a class="reference external" href="https://root.cern.ch/">ROOT</a>,
rather than always searching through a DST that contains lots of things we’re
not interested in.</p>
<p>As well as being the application that runs the stripping,
<a class="reference external" href="http://lhcbdoc.web.cern.ch/lhcbdoc/davinci/">DaVinci</a>
allows you to access events stored in DSTs and copy the information to ROOT
ntuples.
You tell DaVinci what you want it to do through <em>options files</em>, written in
Python.
There are lots of things you can do with DaVinci options files, as there’s lots
of information available on the DST, but for now we’ll just work on getting the
bare essentials up and running.</p>
<p>Our main tool will be the <code class="docutils literal notranslate"><span class="pre">DecayTreeTuple</span></code> object, which we’ll create inside a
file we will call <code class="docutils literal notranslate"><span class="pre">ntuple_options.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">Configurables</span> <span class="kn">import</span> <span class="n">DecayTreeTuple</span>
<span class="kn">from</span> <span class="nn">DecayTreeTuple.Configuration</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># Stream and stripping line we want to use</span>
<span class="n">stream</span> <span class="o">=</span> <span class="s1">&#39;AllStreams&#39;</span>
<span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;D2hhPromptDst2D2KKLine&#39;</span>

<span class="c1"># Create an ntuple to capture D*+ decays from the StrippingLine line</span>
<span class="n">dtt</span> <span class="o">=</span> <span class="n">DecayTreeTuple</span><span class="p">(</span><span class="s1">&#39;TupleDstToD0pi_D0ToKK&#39;</span><span class="p">)</span>
<span class="n">dtt</span><span class="o">.</span><span class="n">Inputs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;/Event/</span><span class="si">{0}</span><span class="s1">/Phys/</span><span class="si">{1}</span><span class="s1">/Particles&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">line</span><span class="p">)]</span>
<span class="n">dtt</span><span class="o">.</span><span class="n">Decay</span> <span class="o">=</span> <span class="s1">&#39;[D*(2010)+ -&gt; (D0 -&gt; K- K+) pi+]CC&#39;</span>
</pre></div>
</div>
<p>This imports the <code class="docutils literal notranslate"><span class="pre">DecayTreeTuple</span></code> class, and then creates an object called
<code class="docutils literal notranslate"><span class="pre">dtt</span></code> representing our ntuple.
Once DaVinci has run, the resulting ntuple will be saved in a folder within the
output ROOT file called <code class="docutils literal notranslate"><span class="pre">TupleDstToD0pi_D0ToKpi</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Inputs</span></code> attribute specifies where <code class="docutils literal notranslate"><span class="pre">DecayTreeTuple</span></code> should look for
particles, and here we want it to look at the output of the stripping line
we’re interested in.</p>
<p>As stripping lines can save many decays to a DST, the <code class="docutils literal notranslate"><span class="pre">Decay</span></code> attribute
specifies what decay we would like to have in our ntuple.
If there are no particles at the <code class="docutils literal notranslate"><span class="pre">Input</span></code> location, or the <code class="docutils literal notranslate"><span class="pre">Decay</span></code> string
doesn’t match any particles at that location, the ntuple will not be filled.</p>
<div class="panel panel-callout docutils container">
<div class="panel-header open docutils container">
<p id="decay-descriptors"><i class="fa fa-info-circle"></i> Decay descriptors</p>
</div>
<div class="panel-body docutils container">
<p>There is a special syntax for the <code class="docutils literal notranslate"><span class="pre">Decay</span></code> attribute string, commonly called
‘decay descriptors’, that allow a lot of flexibility with what you accept.
For example, <code class="docutils literal notranslate"><span class="pre">D0</span> <span class="pre">-&gt;</span> <span class="pre">K-</span> <span class="pre">X+</span></code> will match any D0 decay that contains one
negatively charged kaon and one positively charged track of any species.
More information the decay descriptor syntax can be found on the <a class="reference external" href="https://twiki.cern.ch/twiki/bin/view/LHCb/FAQ/LoKiNewDecayFinders">LoKi decay
finders TWiki
page</a>.</p>
</div>
</div>
<p>Now we need to tell DaVinci how to behave.
The <code class="docutils literal notranslate"><span class="pre">DaVinci</span></code> class allows you to tell DaVinci how many events to run over,
what type of data is being used, what algorithms to run over the events, and so
on.</p>
<p>There are <a class="reference external" href="https://lhcb-doxygen.web.cern.ch/lhcb-doxygen/davinci/latest/py/dc/d2f/class_da_vinci_1_1_configuration_1_1_da_vinci.html">many configuration
attributes</a>
defined on the <code class="docutils literal notranslate"><span class="pre">DaVinci</span></code> object, but we will only set the ones that are
necessary for us.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">Configurables</span> <span class="kn">import</span> <span class="n">DaVinci</span>

<span class="c1"># Configure DaVinci</span>
<span class="n">DaVinci</span><span class="p">()</span><span class="o">.</span><span class="n">UserAlgorithms</span> <span class="o">+=</span> <span class="p">[</span><span class="n">dtt</span><span class="p">]</span>
<span class="n">DaVinci</span><span class="p">()</span><span class="o">.</span><span class="n">InputType</span> <span class="o">=</span> <span class="s1">&#39;DST&#39;</span>
<span class="n">DaVinci</span><span class="p">()</span><span class="o">.</span><span class="n">TupleFile</span> <span class="o">=</span> <span class="s1">&#39;DVntuple.root&#39;</span>
<span class="n">DaVinci</span><span class="p">()</span><span class="o">.</span><span class="n">PrintFreq</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">DaVinci</span><span class="p">()</span><span class="o">.</span><span class="n">DataType</span> <span class="o">=</span> <span class="s1">&#39;2016&#39;</span>
<span class="n">DaVinci</span><span class="p">()</span><span class="o">.</span><span class="n">Simulation</span> <span class="o">=</span> <span class="kc">True</span>
<span class="c1"># Only ask for luminosity information when not using simulated data</span>
<span class="n">DaVinci</span><span class="p">()</span><span class="o">.</span><span class="n">Lumi</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">DaVinci</span><span class="p">()</span><span class="o">.</span><span class="n">Simulation</span>
<span class="n">DaVinci</span><span class="p">()</span><span class="o">.</span><span class="n">EvtMax</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">DaVinci</span><span class="p">()</span><span class="o">.</span><span class="n">CondDBtag</span> <span class="o">=</span> <span class="s1">&#39;sim-20170721-2-vc-md100&#39;</span>
<span class="n">DaVinci</span><span class="p">()</span><span class="o">.</span><span class="n">DDDBtag</span> <span class="o">=</span> <span class="s1">&#39;dddb-20170721-3&#39;</span>
</pre></div>
</div>
<p>Nicely, a lot of the attributes of the <code class="docutils literal notranslate"><span class="pre">DaVinci</span></code> object are self-explanatory:
<code class="docutils literal notranslate"><span class="pre">InputType</span></code> should be <code class="docutils literal notranslate"><span class="pre">'DST'</span></code> when giving DaVinci DST files; <code class="docutils literal notranslate"><span class="pre">PrintFreq</span></code>
defines how often DaVinci should print its status; <code class="docutils literal notranslate"><span class="pre">DataType</span></code> is the year of
data-taking the data corresponds to, which we get from looking at the
bookkeeping path used to get the input DST; <code class="docutils literal notranslate"><span class="pre">Simulation</span></code> should be <code class="docutils literal notranslate"><span class="pre">True</span></code> when
using Monte Carlo data, <code class="docutils literal notranslate"><span class="pre">Lumi</span></code> defines whether to store information on the
integrated luminosity the input data corresponds to; and <code class="docutils literal notranslate"><span class="pre">EvtMax</span></code> defines how
many events to run over, where a value of <code class="docutils literal notranslate"><span class="pre">-1</span></code> means “all events”.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">CondDBtag</span></code> and <code class="docutils literal notranslate"><span class="pre">DDDBtag</span></code> attributes specify the exact detector conditions
that the Monte Carlo was generated with.
Specifying these tags is important, as without them you can end up with the
wrong magnet polarity value in your ntuple, amongst other Bad Things.
You can find the values for these tags in the <a class="reference download internal" download="" href="../_downloads/9d5acfd65b8454688c68d34118b712e8/MC_2016_27163002_Beam6500GeV2016MagDownNu1.625nsPythia8_Sim09c_Trig0x6138160F_Reco16_Turbo03_Stripping28r1NoPrescalingFlagged_ALLSTREAMS.DST.py"><code class="xref download docutils literal notranslate"><span class="pre">bookkeeping</span>
<span class="pre">file</span></code></a>
we downloaded earlier.</p>
<div class="panel panel-callout docutils container">
<div class="panel-header open docutils container">
<p id="database-tags"><i class="fa fa-info-circle"></i> Database tags</p>
</div>
<div class="panel-body docutils container">
<p>Generally, the <code class="docutils literal notranslate"><span class="pre">CondDB</span></code> and <code class="docutils literal notranslate"><span class="pre">DDDB</span></code> tags are different for each dataset you
want to use, but will be the same for all DSTs within a given dataset.</p>
<p>For real collision data, you shouldn’t specify these tags, as the default
tags are the latest and greatest, so just remove those lines from the options
file.</p>
<p>However, when using simulated data, <em>always</em> find out what the database tags are for
your dataset!</p>
<p>There are several ways to access the database tags used for a specific production, but the most reliable one consists of the following steps:</p>
<ul class="simple">
<li><p>Find the bookkeeping location of any DST for your desired event type and conditions (e.g. <code class="docutils literal notranslate"><span class="pre">/lhcb/MC/2016/ALLSTREAMS.DST/00070793/0000/00070793_00000002_7.AllStreams.dst</span></code>).</p></li>
<li><p>The number after <code class="docutils literal notranslate"><span class="pre">ALLSTREAMS.DST</span></code> is the number of the production: in this case, <code class="docutils literal notranslate"><span class="pre">00070793</span></code>.</p></li>
<li><p>Go to the <a class="reference external" href="https://lhcb-portal-dirac.cern.ch/DIRAC/?view=tabs&amp;theme=Grey&amp;url_state=1%7C*LHCbDIRAC.LHCbTransformationMonitor.classes.LHCbTransformationMonitor:,">transformation monitor</a>. Put this number in the field <code class="docutils literal notranslate"><span class="pre">ProductionID(s):</span></code> and press “Submit”. You will see the details of the production to the right.</p></li>
<li><p>Right click on these details, and press “Show request”. The new tab “Production Request manager” will appear to the right of the “LHCb Transformation Monitor”. Go to that tab.</p></li>
<li><p>You will see the details of the MC request. Right click on it, and press “View”.</p></li>
<li><p>A new window will pop up with the complete details of the request. You have to find the “Step 1” section, and the following line in it <code class="docutils literal notranslate"><span class="pre">DDDB:</span> <span class="pre">dddb-20170721-3</span> <span class="pre">Condition</span> <span class="pre">DB:</span> <span class="pre">sim-20170721-2-vc-md100</span></code> contains your database tags.</p></li>
</ul>
<p>Note that the Condition DB tags for different magnet polarities are different: <code class="docutils literal notranslate"><span class="pre">-md100</span></code> should be replaced by <code class="docutils literal notranslate"><span class="pre">-mu100</span></code> for the MagUp conditions.</p>
<p>This method can also be used to find other details about how any data was processed by DIRAC, such as the options files and application versions.</p>
</div>
</div>
<p>In order to run an algorithm that we have previously created, we need to add it
to the <code class="docutils literal notranslate"><span class="pre">UserAlgorithms</span></code> list.
The <code class="docutils literal notranslate"><span class="pre">TupleFile</span></code> attribute defines the name of the ROOT output file that DaVinci
will store any algorithm output in, which should be our ntuple.</p>
<div class="panel panel-callout docutils container">
<div class="panel-header open docutils container">
<p id="being-smart-and-efficient"><i class="fa fa-info-circle"></i> Being smart and efficient</p>
</div>
<div class="panel-body docutils container">
<p>Typical stripping lines take only a small part of the stripped stream - so, a small fraction of events in the DST: actually, usually you care about a single TES location!
At the same time, event unpacking and running the DecayTreeTuple machinery for each event is time-consuming.
Consequently, DSTs can be processed much faster if before unpacking we select <em>only</em> events which are likely to accomodate the desired TES location. This can be achieved, for example, by requiring a prefilter checking whether event passes a stripping requirement. You may also filter on trigger decisions - this is an idea behind the Turbo stream.
As a conclusion, it is <em>strongly</em> recommended to exploit the <code class="docutils literal notranslate"><span class="pre">EventPreFilters</span></code> method offered by <code class="docutils literal notranslate"><span class="pre">DaVinci</span></code>: this feature can save a lot of processing time and collaboration’s computing resources when running over millions of events.
To require events to pass a specific stripping line requirement, one should add these lines to the options file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">PhysConf.Filters</span> <span class="kn">import</span> <span class="n">LoKi_Filters</span>
<span class="n">fltrs</span> <span class="o">=</span> <span class="n">LoKi_Filters</span> <span class="p">(</span>
    <span class="n">STRIP_Code</span> <span class="o">=</span> <span class="s2">&quot;HLT_PASS_RE(&#39;StrippingD2hhPromptDst2D2KKLineDecision&#39;)&quot;</span>
<span class="p">)</span>
<span class="n">DaVinci</span><span class="p">()</span><span class="o">.</span><span class="n">EventPreFilters</span> <span class="o">=</span> <span class="n">fltrs</span><span class="o">.</span><span class="n">filters</span><span class="p">(</span><span class="s1">&#39;Filters&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Here we use the <a class="reference external" href="https://lhcb-doxygen.web.cern.ch/lhcb-doxygen/davinci/latest/d7/dae/namespace_lo_ki_1_1_cuts.html#aee4bba9ae8443acd970dd52e20e5b8c1">LoKi functor <code class="docutils literal notranslate"><span class="pre">HLT_PASS_RE</span></code></a> which checks for a positive decision on (in this case) the stripping line.
You may investigate some of more advanced examples of <code class="docutils literal notranslate"><span class="pre">EventPreFilters</span></code> usage <a class="reference external" href="https://twiki.cern.ch/twiki/bin/view/LHCb/FAQ/DaVinciFAQ#How_to_process_the_stripped_DSTs">here</a> and <a class="reference external" href="https://gitlab.cern.ch/lhcb/Phys/blob/master/Phys/PhysConf/python/PhysConf/Filters.py">here</a>.</p>
</div>
</div>
<p>All that’s left to do is to say what data we would like to run over.
As we already have a data file <a class="reference internal" href="files-from-grid.html"><span class="doc">downloaded locally</span></a>, we
define that as our input data.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">GaudiConf</span> <span class="kn">import</span> <span class="n">IOHelper</span>

<span class="c1"># Use the local input data</span>
<span class="n">IOHelper</span><span class="p">()</span><span class="o">.</span><span class="n">inputFiles</span><span class="p">([</span>
    <span class="s1">&#39;./00070793_00000001_7.AllStreams.dst&#39;</span>
<span class="p">],</span> <span class="n">clear</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>This says to use the <code class="docutils literal notranslate"><span class="pre">.dst</span></code> file that is in the same directory as the options
file, and to clear any previous input files that might have been defined.</p>
<p>That’s it! We’re ready to run DaVinci.</p>
<p>In the same folder as your options file <code class="docutils literal notranslate"><span class="pre">ntuple_options.py</span></code> and your DST file
ending in <code class="docutils literal notranslate"><span class="pre">.dst</span></code>, there’s just a single command you need run on <code class="docutils literal notranslate"><span class="pre">lxplus</span></code>.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ lb-run DaVinci/v45r1 gaudirun.py ntuple_options.py
</pre></div>
</div>
<p>The full options file we’ve created, <code class="docutils literal notranslate"><span class="pre">ntuple_options.py</span></code>, is <a class="reference download internal" download="" href="../_downloads/3ee3ffee79a4a0f03951a80eb66942b7/ntuple_options.py"><code class="xref download docutils literal notranslate"><span class="pre">available</span>
<span class="pre">here</span></code></a>.
A slightly modified version that uses remote files (using an XML catalog as
<a class="reference internal" href="files-from-grid.html"><span class="doc">described here</span></a>) is <a class="reference download internal" download="" href="../_downloads/fc8e63525922f8a25d7a78d8697d14ec/ntuple_options_xmlcatalog.py"><code class="xref download docutils literal notranslate"><span class="pre">available</span>
<span class="pre">here</span></code></a>.</p>
<p>You can now view and inspect your ntuple using ROOT <code class="docutils literal notranslate"><span class="pre">TBrowser</span></code> just do:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ root -l DVntuple.root 

root <span class="o">[</span><span class="m">0</span><span class="o">]</span> 
Attaching file DVntuple.root as _file0...
<span class="o">(</span>TFile *<span class="o">)</span> 0x2ae94f0
root <span class="o">[</span><span class="m">1</span><span class="o">]</span> new TBrowser
<span class="o">(</span>TBrowser *<span class="o">)</span> 0x2fe31b0
</pre></div>
</div>
<div class="panel panel-callout docutils container">
<div class="panel-header open docutils container">
<p id="using-a-microdst"><i class="fa fa-info-circle"></i> Using a microDST</p>
</div>
<div class="panel-body docutils container">
<p>A microDST (or µDST) is a smaller version of a DST.
Some stripping lines go to µDSTs, and some go to DSTs.
There are two things that need changing in our options file in order to have
it work when it is used with a stripping line that goes to a µDST:</p>
<ol class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">DecayTreeTuple.Inputs</span></code> attribute should start at the word
<code class="docutils literal notranslate"><span class="pre">Phys</span></code>; and</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">RootInTES</span></code> attribute on the <code class="docutils literal notranslate"><span class="pre">DaVinci</span></code> object has to be set to
<code class="docutils literal notranslate"><span class="pre">/Event/$STREAM</span></code></p></li>
</ol>
<p>In context, the changes look like</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dtt</span><span class="o">.</span><span class="n">Inputs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Phys/</span><span class="si">{0}</span><span class="s1">/Particles&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line</span><span class="p">)]</span>
<span class="c1"># ...</span>
<span class="n">DaVinci</span><span class="p">()</span><span class="o">.</span><span class="n">RootInTES</span> <span class="o">=</span> <span class="s1">&#39;/Event/</span><span class="si">{0}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, FCC Starterkit

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>